{% extends "base.html" %}

{% block title %}{% if post %}Edit Research{% else %}New Research{% endif %} - the-planet-mars.org{% endblock %}

{% block head %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}
<section class="editor-page container">
    <header class="editor-header">
        <h1>{% if post %}Modify Log Entry{% else %}Initialize New Research{% endif %}</h1>
        <a href="/admin" class="text-dim">Cancel</a>
    </header>

    <form id="post-form" action="{% if post %}/admin/post/edit/{{ post.id }}{% else %}/admin/post/new{% endif %}"
        method="POST">
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" name="title" id="title" value="{{ post.title if post else '' }}" required
                placeholder="e.g. Discovery of Brine in Gale Crater">
        </div>

        <div class="form-group">
            <label for="tags">Tags (comma separated)</label>
            <input type="text" name="tags" id="tags" value="{{ post.tags|join(', ') if post else '' }}"
                placeholder="geology, water, nasa">
        </div>

        <div class="form-row">
            <div class="form-group flex-2">
                <label for="media_url">Media URL (Image or Video)</label>
                <input type="text" name="media_url" id="media_url" value="{{ post.media_url if post else '' }}"
                    placeholder="https://...">
            </div>
            <div class="form-group flex-1">
                <label for="media_type">Media Type</label>
                <select name="media_type" id="media_type">
                    <option value="image" {% if post and post.media_type=='image' %}selected{% endif %}>Image</option>
                    <option value="video" {% if post and post.media_type=='video' %}selected{% endif %}>Video</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="language">Research Language</label>
            <select name="language" id="language">
                <option value="en" {% if post and post.language=='en' %}selected{% endif %}>English (EN)</option>
                <option value="it" {% if post and post.language=='it' %}selected{% endif %}>Italiano (IT)</option>
            </select>
        </div>

        <div class="form-group">
            <label>Research Content</label>
            <div id="editor-container" style="height: 400px; background: white; color: black; border-radius: 8px;">
                {{ post.content|safe if post else '' }}
            </div>
            <input type="hidden" name="content" id="content-input">
        </div>

        <div class="editor-footer">
            <button type="submit" name="status" value="draft" class="btn btn-secondary">Save Draft</button>
            <button type="submit" name="status" value="published" class="btn btn-primary">Publish to Surface</button>
        </div>
    </form>
</section>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'link'],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                ['clean']
            ]
        }
    });

    var form = document.getElementById('post-form');
    form.onsubmit = function () {
        var content = document.querySelector('input[name=content]');
        content.value = quill.root.innerHTML;
        return true;
    };
</script>

<style>
    .editor-page {
        padding: 5rem 2rem;
    }

    .editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3rem;
    }

    .editor-header h1 {
        font-family: 'Playfair Display', serif;
        color: var(--mars-orange);
    }

    .form-group {
        margin-bottom: 2rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-dim);
        font-size: 0.8rem;
        text-transform: uppercase;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        background: var(--crater-gray);
        border: 1px solid #333;
        padding: 1rem;
        color: white;
        border-radius: 8px;
    }

    .form-row {
        display: flex;
        gap: 2rem;
    }

    .flex-1 {
        flex: 1;
    }

    .flex-2 {
        flex: 2;
    }

    .editor-footer {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 3rem;
    }

    .text-dim {
        color: var(--text-dim);
        text-decoration: none;
    }
</style>
{% endblock %}